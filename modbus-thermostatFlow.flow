## Modbus settings for the modbus LCD touch screen

- Default baud rate 9600
- address 1
-




[{"id":"6b94c996.515038","type":"tab","label":"Modbus Thermostat","disabled":false,"info":""},{"id":"1e86e6da.538329","type":"modbus-read","z":"6b94c996.515038","name":"","topic":"","showStatusActivities":false,"logIOActivities":false,"showErrors":false,"unitid":"3","dataType":"HoldingRegister","adr":"0","quantity":"10","rate":"18","rateUnit":"s","delayOnStart":false,"startDelayTime":"","server":"f33f2528.7b75a8","useIOFile":false,"ioFile":"","useIOForPayload":false,"x":150,"y":620,"wires":[["5ec1381b.b45748","f77ca90d.9ea948"],[]]},{"id":"5ec1381b.b45748","type":"debug","z":"6b94c996.515038","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":370,"y":660,"wires":[]},{"id":"f77ca90d.9ea948","type":"function","z":"6b94c996.515038","name":"","func":"msg.enable = msg.payload[0];\nmsg.fanSpeed = msg.payload[1];\nmsg.temp = msg.payload[8]/10;\nmsg.setpoint = msg.payload[3]/10;\nmsg.timestamp = Date.now();\n\nnode.status({fill:\"blue\", shape:\"dot\", text: Date()});\n\nreturn msg;","outputs":1,"noerr":0,"x":350,"y":560,"wires":[["aed78feb.65402"]]},{"id":"aed78feb.65402","type":"function","z":"6b94c996.515038","name":"Limit Setpoint","func":"if (msg.setpoint < 20) {\n    msg.setpoint = 20;\n} else if (msg.setpoint > 22) {\n    msg.setpoint = 22;\n}\n\nreturn msg;","outputs":1,"noerr":0,"x":500,"y":560,"wires":[["b0259550.78a188"]]},{"id":"5982106f.de28c","type":"modbus-read","z":"6b94c996.515038","name":"","topic":"","showStatusActivities":false,"logIOActivities":false,"showErrors":false,"unitid":"2","dataType":"HoldingRegister","adr":"0","quantity":"10","rate":"13","rateUnit":"s","delayOnStart":false,"startDelayTime":"","server":"f33f2528.7b75a8","useIOFile":false,"ioFile":"","useIOForPayload":false,"x":150,"y":380,"wires":[["1e3d58a2.307e47","56192150.f0c68"],[]]},{"id":"1e3d58a2.307e47","type":"debug","z":"6b94c996.515038","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":370,"y":420,"wires":[]},{"id":"56192150.f0c68","type":"function","z":"6b94c996.515038","name":"","func":"msg.enable = msg.payload[0];\nmsg.fanSpeed = msg.payload[1];\nmsg.temp = msg.payload[8]/10;\nmsg.setpoint = msg.payload[3]/10;\nmsg.timestamp = Date.now();\n\nmsg.topic = \"PAC 12.1 Address 2\";\n\nnode.status({fill:\"blue\", shape:\"dot\", text: Date()});\n\nreturn msg;","outputs":1,"noerr":0,"x":350,"y":320,"wires":[["e4c6d5a1.5ca3d8"]]},{"id":"e4c6d5a1.5ca3d8","type":"function","z":"6b94c996.515038","name":"Limit Setpoint","func":"if (msg.setpoint < 21) {\n    msg.setpoint = 21;\n} else if (msg.setpoint > 23) {\n    msg.setpoint = 23;\n}\n\nreturn msg;","outputs":1,"noerr":0,"x":500,"y":320,"wires":[["63da65cd.33184c"]]},{"id":"a51477b4.da04f8","type":"modbus-read","z":"6b94c996.515038","name":"","topic":"","showStatusActivities":false,"logIOActivities":false,"showErrors":false,"unitid":"1","dataType":"HoldingRegister","adr":"0","quantity":"10","rate":"11","rateUnit":"s","delayOnStart":false,"startDelayTime":"","server":"f33f2528.7b75a8","useIOFile":false,"ioFile":"","useIOForPayload":false,"x":150,"y":180,"wires":[["14e18a2d.7c8ef6","18f5448e.ce47ab"],[]]},{"id":"14e18a2d.7c8ef6","type":"debug","z":"6b94c996.515038","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":370,"y":220,"wires":[]},{"id":"18f5448e.ce47ab","type":"function","z":"6b94c996.515038","name":"","func":"msg.enable = msg.payload[0];\nmsg.fanSpeed = msg.payload[1];\nmsg.temp = msg.payload[8]/10;\nmsg.setpoint = msg.payload[3]/10;\nmsg.timestamp = Date.now();\n\nmsg.topic = \"PAC 12.1 Address 1\";\n\nnode.status({fill:\"blue\", shape:\"dot\", text: Date()});\n\nreturn msg;","outputs":1,"noerr":0,"x":350,"y":120,"wires":[["556d2fa9.6bad4"]]},{"id":"556d2fa9.6bad4","type":"function","z":"6b94c996.515038","name":"Limit Setpoint","func":"if (msg.setpoint < 21) {\n    msg.setpoint = 21;\n} else if (msg.setpoint > 23) {\n    msg.setpoint = 23;\n}\n\nreturn msg;","outputs":1,"noerr":0,"x":500,"y":120,"wires":[["63da65cd.33184c"]]},{"id":"8570d643.dcaa48","type":"comment","z":"6b94c996.515038","name":"AC2 - PAC 12.2 Comms Room - Address 3 - IP 192.168.0.236","info":"","x":520,"y":520,"wires":[]},{"id":"751382d.135537c","type":"comment","z":"6b94c996.515038","name":"AC1 - PAC 12.1 Meeting Room - Address 1 - IP 192.168.0.236","info":"","x":520,"y":80,"wires":[]},{"id":"b2787376.acca2","type":"comment","z":"6b94c996.515038","name":"AC1 - PAC 12.1 Meeting Room - Address 2 - IP 192.168.0.236","info":"","x":520,"y":280,"wires":[]},{"id":"b0259550.78a188","type":"function","z":"6b94c996.515038","name":"Modbus to Bonescript","func":"node.status({fill:\"green\", shape:\"dot\", text:\"T: \" + msg.temp + \" SP: \" + msg.setpoint +\" E: \" + msg.enable});\n\nmsg = {\n        \"url\": \"http://localhost:4000/points\",\n        \"method\": \"PATCH\",\n        \"headers\": {\n            \"content-type\": \"application/json\"\n        },\n        \"payload\": [{\n            \"id\": \"AC2_ZONE_TEMP\",\n            \"value\": msg.temp,\n            \"priority\": 16\n        }, {\n            \"id\": \"AC2_SETPOINT\",\n            \"value\": msg.setpoint,\n            \"priority\": 16\n        }, {\n            \"id\": \"AC2_WALL_SWITCH\",\n            \"value\": msg.enable,\n            \"priority\": 16\n        }]\n    };\nreturn msg;\n\n\n","outputs":1,"noerr":0,"x":700,"y":560,"wires":[["ca10aadc.e91348","c78937de.092f38"]]},{"id":"ca10aadc.e91348","type":"debug","z":"6b94c996.515038","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":890,"y":540,"wires":[]},{"id":"c78937de.092f38","type":"http request","z":"6b94c996.515038","name":"","method":"use","ret":"txt","url":"","tls":"","x":910,"y":580,"wires":[["3c87ca84.65bf36"]]},{"id":"3c87ca84.65bf36","type":"debug","z":"6b94c996.515038","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","x":1070,"y":580,"wires":[]},{"id":"63da65cd.33184c","type":"function","z":"6b94c996.515038","name":"Average","func":"const tempOne = context.get('tempOne') || 22\nconst tempTwo = context.get('tempTwo') || 22\nconst setpointOne = context.get('setpointOne') || 22\nconst setpointTwo = context.get('setpointTwo') || 22\nconst enableOne = context.get('enableOne') || 0\nconst enableTwo = context.get('enableTwo') || 0\n\nif (msg.topic === \"PAC 12.1 Address 1\") {\n    context.set('tempOne', msg.temp);\n    context.set('setpointOne', msg.setpoint);\n    context.set('enableOne', msg.enable);\n} else if (msg.topic === \"PAC 12.1 Address 2\") {\n    context.set('tempTwo', msg.temp);\n    context.set('setpointTwo', msg.setpoint);\n    context.set('enableTwo', msg.enable);\n} else {\n    msg.temp = (tempOne + tempTwo) / 2;\n    msg.setpoint = (setpointOne + setpointTwo) / 2;\n    msg.enable = enableOne || enableTwo;\n    node.send(msg);\n}","outputs":1,"noerr":0,"x":760,"y":220,"wires":[["86499205.bf89"]]},{"id":"86499205.bf89","type":"function","z":"6b94c996.515038","name":"Modbus to Bonescript","func":"node.status({fill:\"green\", shape:\"dot\", text:\"T: \" + msg.temp + \" SP: \" + msg.setpoint +\" E: \" + msg.enable});\n\nmsg = {\n    \"url\": \"http://localhost:4000/points\",\n    \"method\": \"PATCH\",\n    \"headers\": {\n        \"content-type\": \"application/json\"\n    },\n    \"payload\": [{\n        \"id\": \"AC1_ZONE_TEMP\",\n        \"value\": msg.temp,\n        \"priority\": 16\n    }, {\n        \"id\": \"AC1_SETPOINT\",\n        \"value\": msg.setpoint,\n        \"priority\": 16\n    }, {\n        \"id\": \"AC1_WALL_SWITCH\",\n        \"value\": msg.enable,\n        \"priority\": 16\n    }]\n};\n\nreturn msg;","outputs":1,"noerr":0,"x":940,"y":220,"wires":[["d9c884b5.d8c108","d842a705.a767c8"]]},{"id":"d9c884b5.d8c108","type":"debug","z":"6b94c996.515038","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","x":1130,"y":200,"wires":[]},{"id":"d842a705.a767c8","type":"http request","z":"6b94c996.515038","name":"","method":"use","ret":"txt","url":"","tls":"","x":1150,"y":240,"wires":[["dd4e5b36.a26ce8"]]},{"id":"dd4e5b36.a26ce8","type":"debug","z":"6b94c996.515038","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","x":1310,"y":240,"wires":[]},{"id":"de027afd.d23718","type":"inject","z":"6b94c996.515038","name":"","topic":"","payload":"","payloadType":"date","repeat":"5","crontab":"","once":true,"onceDelay":"12","x":570,"y":220,"wires":[["63da65cd.33184c"]]},{"id":"f33f2528.7b75a8","type":"modbus-client","z":"","name":"","clienttype":"tcp","bufferCommands":true,"stateLogEnabled":false,"tcpHost":"192.168.0.236","tcpPort":"502","tcpType":"TPC-RTU-BUFFERED","serialPort":"/dev/ttyUSB","serialType":"RTU-BUFFERD","serialBaudrate":"9600","serialDatabits":"8","serialStopbits":"1","serialParity":"none","serialConnectionDelay":"100","unit_id":"1","commandDelay":"100","clientTimeout":"3000","reconnectTimeout":"4000"}]
